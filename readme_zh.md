# SayKey

(ç®€ä½“ä¸­æ–‡|[English](./readme.md))

SayKey
æ˜¯ä¸€ä¸ªè¯­éŸ³è¾“å…¥æ³•ï¼Œä¸ºä½ æä¾›å¿«é€Ÿã€å‡†ç¡®ã€å®Œå…¨ç¦»çº¿çš„è¯­éŸ³è½¬æ–‡å­—ä½“éªŒã€‚ç”± [SenceVoice](https://github.com/FunAudioLLM/SenseVoice)
é©±åŠ¨ã€‚

![python3.10](https://img.shields.io/badge/python-3.10-green.svg)
![Windows](https://img.shields.io/badge/Windows-supported-blue.svg)

## ä¸»è¦ç‰¹æ€§

- ğŸš€ è¯­éŸ³è¯†åˆ«å¿«é€Ÿå‡†ç¡®
- ğŸ”’ å®Œå…¨ç¦»çº¿è¿è¡Œï¼Œä¿æŠ¤éšç§
- âŒ¨ï¸ ä¾¿æ·çš„çƒ­é”®æ¿€æ´»
- ğŸ¯ æ™ºèƒ½æ·»åŠ æ ‡ç‚¹
- ğŸ”§ å¯ä»¥çµæ´»é…ç½®

## å¼€å‘ç¯å¢ƒ

- Python 3.10
- `requirements.txt` ä¸­åˆ—å‡ºçš„ä¾èµ–é¡¹ï¼ˆæˆ–å¦‚ä¸‹æ‰€è¿°ï¼‰

## å¦‚ä½•ä¸‹è½½å’Œä½¿ç”¨ SayKey

1. [ç‚¹æˆ‘ä¸‹è½½](https://github.com/WenJing95/SayKey/releases/download/v1.0.0/SayKey.zip)
2. åœ¨æ‚¨çš„ç”µè„‘ä¸Šæ‰¾åˆ°ä¸‹è½½çš„"SayKey.zip"æ–‡ä»¶ï¼ˆé€šå¸¸åœ¨"ä¸‹è½½"æ–‡ä»¶å¤¹ä¸­ï¼‰ã€‚
3. å³é”®ç‚¹å‡»"SayKey.zip"ï¼Œé€‰æ‹©"å…¨éƒ¨è§£å‹ç¼©"æˆ–"è§£å‹åˆ°\SayKey"ã€‚
4. æ‰“å¼€è§£å‹åå‡ºç°çš„æ–‡ä»¶å¤¹ã€‚
5. åŒå‡»"SayKey.exe"æ¥å¯åŠ¨ç¨‹åºã€‚
6. æ‚¨ä¼šåœ¨ä»»åŠ¡æ ä¸Šæ–¹çœ‹åˆ°ä¸€ä¸ªâ€ç™½è‰²å°èƒ¶å›Šâ€œï¼Œè¿™å°±æ˜¯SayKeyçš„ä¸»ç•Œé¢ã€‚
7. å½“æ‚¨æƒ³è¦ä½¿ç”¨è¯­éŸ³è¾“å…¥æ—¶ï¼ŒåŒæ—¶æŒ‰ä½ `Ctrl` é”®å’Œ `Q` é”®ã€‚
8. æŒ‰ä½ `Ctrl+Q` çš„åŒæ—¶ï¼Œè¯´å‡ºæ‚¨æƒ³è¦è¾“å…¥çš„å†…å®¹ã€‚å°èƒ¶å›Šä¼šæ”¹å˜å½¢çŠ¶ï¼Œè¡¨ç¤ºæ­£åœ¨å¬æ‚¨è¯´è¯ã€‚
9. è¯´å®Œåï¼Œæ¾å¼€ `Ctrl+Q` é”®ã€‚æ‚¨çš„è¯­éŸ³å°†ä¼šè¢«è½¬æ¢ä¸ºæ–‡å­—ï¼Œè¾“å‡ºåˆ°å…‰æ ‡æ‰€åœ¨ä½ç½®ã€‚

### é™„åŠ ä¿¡æ¯

- å³é”®ç‚¹å‡»å°èƒ¶å›Šå¯ä»¥çœ‹åˆ°èœå•ã€‚åœ¨èœå•ä¸­ï¼Œæ‚¨å¯ä»¥ï¼š
    - æŸ¥çœ‹SayKeyçš„å¯åŠ¨çŠ¶æ€ï¼ˆåœ¨å®¶ç”¨PCä¸Šï¼Œå¤§æ¦‚éœ€è¦5ç§’é’Ÿæ¥åŠ è½½è¯­éŸ³è¯†åˆ«æ¨¡å‹ï¼‰
    - é€‰æ‹©éº¦å…‹é£
    - æ›´æ”¹è§¦å‘è¯­éŸ³è¯†åˆ«çš„å¿«æ·é”®
    - é€‰æ‹©æ‚¨å¸¸ç”¨çš„è¯­è¨€
    - å°†SayKeyæœ€å°åŒ–ï¼ˆæœ€å°åŒ–åï¼Œæ‚¨å¯ä»¥åœ¨Windowsç³»ç»Ÿä»»åŠ¡æ ä¸­çœ‹åˆ°SayKeyçš„å°å›¾æ ‡ï¼‰
- å¦‚æœæ‚¨é‡åˆ°äº†"è¿å‡»"ï¼ˆä¸€å¥è¯è¢«è¯†åˆ«äº†å¤šæ¬¡ï¼‰çš„ç°è±¡ï¼Œæ‚¨å¯ä»¥é€€å‡ºç¨‹åºå¹¶é‡æ–°å¯åŠ¨ã€‚ç¨‹åºå°†ä¼šè‡ªåŠ¨ä¿®å¤è¿™ä¸ªé—®é¢˜ã€‚

## å¼€å‘

1. **å…‹éš†ä»“åº“**

   ```bash
   git clone https://github.com/WenJing95/SayKey.git
   cd SayKey
   ```

2. **å®‰è£…æœåŠ¡å™¨ç«¯ç¯å¢ƒ(éœ€è¦python3.10)**

   ```bash
   cd ./backend
   cd CT-Transformer-punctuation
   pip install -e .
   pip install requirements.txt
   # å¯åŠ¨
    python main.py --sense-voice=./sherpa-onnx/model.int8.onnx --tokens=./sherpa-onnx/tokens.txt
   ```

2. **å®‰è£…å®¢æˆ·ç«¯ç¯å¢ƒ(éœ€è¦nodejs)**

   ```bash
   # å®‰è£…
    cd ./frontend
    npm install
   # å¯åŠ¨
    npm run build
    npm start
   ```

## ä½¿ç”¨æ–¹æ³•

### å‘½ä»¤è¡Œå‚æ•°

ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¡Œå‚æ•°è¿è¡Œåç«¯æœåŠ¡å™¨ï¼š

```bash
python main.py --sense-voice=./sherpa-onnx/model.int8.onnx --tokens=./sherpa-onnx/tokens.txt
```

å¿…éœ€å‚æ•°ï¼š

- `--tokens`ï¼šè¯­éŸ³è¯†åˆ«æ¨¡å‹æ‰€éœ€çš„ tokens.txt æ–‡ä»¶è·¯å¾„ã€‚
- `--sense-voice`ï¼šSenseVoice çš„ model.onnx æ–‡ä»¶è·¯å¾„ã€‚

å¯é€‰å‚æ•°ï¼š

- `--num-threads`ï¼šçº¿ç¨‹æ•°ï¼ˆé»˜è®¤ï¼š4ï¼‰ã€‚
- `--microphone-index`ï¼šè¦ä½¿ç”¨çš„éº¦å…‹é£ç´¢å¼•ã€‚å¦‚æœæœªæŒ‡å®šï¼Œåˆ™ä½¿ç”¨é»˜è®¤ç³»ç»Ÿéº¦å…‹é£ã€‚
- `--hotkey`ï¼šå¼€å§‹å½•éŸ³çš„çƒ­é”®ç»„åˆï¼ˆé»˜è®¤ï¼šctrl+qï¼‰ã€‚
- `--api-port`ï¼šAPI æœåŠ¡å™¨çš„ç«¯å£å·ï¼ˆé»˜è®¤ï¼š58652ï¼‰ã€‚
- `--punc-model-dir`ï¼šæ ‡ç‚¹æ¨¡å‹æ–‡ä»¶çš„ç›®å½•è·¯å¾„ï¼ˆé»˜è®¤ï¼š./punc-onnxï¼‰ã€‚
- `--host`ï¼šAPI æœåŠ¡å™¨ç»‘å®šçš„ä¸»æœºåœ°å€ï¼ˆé»˜è®¤ï¼šlocalhostï¼‰ã€‚

### è¿è¡ŒæœåŠ¡å™¨

å¯åŠ¨æœåŠ¡å™¨åï¼Œä½ å°†çœ‹è¿™æ ·çš„è¾“å‡ºï¼š

```
SayKey is running. Hold ctrl+q to start recording, release to recognize.
Important: Ensure the cursor is in the desired input location before using voice typing.
INFO:     Uvicorn running on http://localhost:58652 (Press CTRL+C to quit)
```

æ ¹æ®æç¤ºï¼Œä½ å¯ä»¥æŒ‰ä½ `ctrl+q` å¼€å§‹å½•éŸ³ï¼Œæ¾å¼€ `ctrl+q` è¿›è¡Œè¯†åˆ«

## API ç«¯ç‚¹

æä¾›äº†å‡ ä¸ªç”¨äºäº¤äº’å’Œé…ç½®çš„ API ã€‚æ‰€æœ‰ç«¯ç‚¹éƒ½å¯ä»¥é€šè¿‡ HTTP è¯·æ±‚è®¿é—®ï¼ŒæœåŠ¡å™¨è¿è¡Œåœ¨æŒ‡å®šçš„ `--api-port`ï¼ˆé»˜è®¤ä¸º 58652ï¼‰ä¸Šã€‚

### 1. ä¿æ´»ç«¯ç‚¹

- URL: `GET /ping`
- æè¿°ï¼šæ£€æŸ¥åç«¯æœåŠ¡å™¨æ˜¯å¦æ­£åœ¨è¿è¡Œã€‚
- å“åº”ï¼š

  ```json
  {
    "status": "alive"
  }
  ```

- ç¤ºä¾‹ï¼š

  ```bash
  curl http://localhost:58652/ping
  ```

### 2. åˆ—å‡ºéŸ³é¢‘è®¾å¤‡

- URL: `GET /list_audio_devices`
- æè¿°ï¼šæ£€ç´¢å¯ç”¨éŸ³é¢‘è¾“å…¥è®¾å¤‡çš„åˆ—è¡¨ã€‚
- å“åº”ç¤ºä¾‹ï¼š

  ```json
  {
    "devices": [
      {
        "index": 0,
        "name": "Microphone (Realtek High Definition Audio)",
        "is_current": true
      },
      {
        "index": 1,
        "name": "Stereo Mix (Realtek High Definition Audio)",
        "is_current": false
      }
    ]
  }
  ```

- ç¤ºä¾‹ï¼š

  ```bash
  curl http://localhost:58652/list_audio_devices
  ```

### 3. è®¾ç½®éŸ³é¢‘è®¾å¤‡

- URL: `POST /set_audio_device`
- æè¿°ï¼šé€šè¿‡æŒ‡å®šç´¢å¼•è®¾ç½®éº¦å…‹é£è®¾å¤‡ã€‚
- è¯·æ±‚ä½“ï¼š

  ```json
  {
    "index": 1
  }
  ```

- æˆåŠŸå“åº”ç¤ºä¾‹ï¼š

  ```json
  {
    "status": "success",
    "message": "success",
    "device": {
      "index": 1,
      "name": "Microphone (Realtek High Definition Audio)"
    }
  }
  ```

- å¤±è´¥å“åº”ç¤ºä¾‹ï¼š

  ```json
  {
    "status": "error",
    "message": "Invalid device index",
    "device": {
      "index": 0,
      "name": "Default System Device"
    }
  }
  ```

- ç¤ºä¾‹ï¼š

  ```bash
  curl -X POST http://localhost:58652/set_audio_device \
       -H "Content-Type: application/json" \
       -d '{"index": 1}'
  ```

### 4. è®¾ç½®çƒ­é”®

- URL: `POST /set_hotkey`
- æè¿°ï¼šé…ç½®ç”¨äºå¼€å§‹å’Œåœæ­¢éŸ³é¢‘å½•åˆ¶çš„çƒ­é”®ç»„åˆã€‚
- è¯·æ±‚ä½“ï¼š

  ```json
  {
    "hotkey": "ctrl+q"
  }
  ```

- æˆåŠŸå“åº”ç¤ºä¾‹ï¼š

  ```json
  {
    "status": "success",
    "message": "success",
    "hotkey": "ctrl+q"
  }
  ```

- å¤±è´¥å“åº”ç¤ºä¾‹ï¼š

  ```json
  {
    "status": "error",
    "message": "Invalid hotkey combination",
    "hotkey": "ctrl+shift+a"
  }
  ```

- ç¤ºä¾‹ï¼š

  ```bash
  curl -X POST http://localhost:58652/set_hotkey \
       -H "Content-Type: application/json" \
       -d '{"hotkey": "ctrl+q"}'
  ```

### 5. è·å–çƒ­é”®

- URL: `GET /get_hotkey`
- æè¿°ï¼šæ£€ç´¢å½“å‰é…ç½®çš„çƒ­é”®ç»„åˆã€‚
- å“åº”ç¤ºä¾‹ï¼š

  ```json
  {
    "hotkey": "ctrl+q"
  }
  ```

- ç¤ºä¾‹ï¼š

  ```bash
  curl http://localhost:58652/get_hotkey
  ```

## æ³¨æ„äº‹é¡¹

- **æƒé™**ï¼škeyboard åº“å¯èƒ½éœ€è¦ç®¡ç†å‘˜æƒé™æ‰èƒ½æ­£å¸¸è¿è¡Œã€‚å¦‚æœé‡åˆ°çƒ­é”®æ£€æµ‹æˆ–æ–‡æœ¬è¾“å…¥æ¨¡æ‹Ÿé—®é¢˜ï¼Œè¯·ä»¥é€‚å½“çš„æƒé™è¿è¡Œåç«¯æœåŠ¡å™¨ã€‚
- **ç³»ç»Ÿå…¼å®¹æ€§**ï¼šæ”¯æŒWindowsï¼Œå…¶ä»–ç³»ç»Ÿæœªæµ‹è¯•ã€‚
- **çƒ­é”®å†²çª**ï¼šé€‰æ‹©çƒ­é”®æ—¶è¦è°¨æ…ã€‚æŒ‰é”®å¯èƒ½ä¼šå¹²æ‰°ç³»ç»Ÿå¿«æ·é”®æˆ–å…¶ä»–ç¨‹åºã€‚
- **å…¶ä»–é—®é¢˜**ï¼šç”±äºè°ƒç”¨äº†ç³»ç»Ÿçš„keyboardæ¥å£è¿›è¡Œè¾“å…¥ï¼Œç¨‹åºå¯èƒ½ä¼šè¢«ä¸€äº›è½¯ä»¶è¯†åˆ«ä¸ºå¤–æŒ‚ã€‚

## æ„Ÿè°¢ä»¥ä¸‹é¡¹ç›®

1. æœ¬é¡¹ç›®çš„è¯­éŸ³è¯†åˆ«èƒ½åŠ›æ¥è‡ª [SenseVoice](https://github.com/FunAudioLLM/SenseVoice)
2. æœ¬é¡¹ç›®ä½¿ç”¨äº† [lovemefan](https://github.com/lovemefan/)
   å¼€å‘çš„ [CT-Transformer-punctuation](https://github.com/lovemefan/CT-Transformer-punctuation) é¡¹ç›®ä»£ç 
